<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HikariCP Controller Service | MBIO blog</title>
    <meta name="description" content="mbio 개발 관련 블로그">
    <link rel="icon" href="/blog/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/blog/assets/css/0.styles.13ac442d.css" as="style"><link rel="preload" href="/blog/assets/js/app.789fa554.js" as="script"><link rel="preload" href="/blog/assets/js/13.7f9cd5cc.js" as="script"><link rel="preload" href="/blog/assets/js/2.52a581a5.js" as="script"><link rel="preload" href="/blog/assets/js/16.62b0f00f.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.477e4f7e.js"><link rel="prefetch" href="/blog/assets/js/11.5a729c02.js"><link rel="prefetch" href="/blog/assets/js/12.eb8e30f1.js"><link rel="prefetch" href="/blog/assets/js/14.8020f2bb.js"><link rel="prefetch" href="/blog/assets/js/15.13599345.js"><link rel="prefetch" href="/blog/assets/js/17.204214b2.js"><link rel="prefetch" href="/blog/assets/js/18.198a9899.js"><link rel="prefetch" href="/blog/assets/js/19.4de81cec.js"><link rel="prefetch" href="/blog/assets/js/20.fc4a2420.js"><link rel="prefetch" href="/blog/assets/js/21.e09f05a5.js"><link rel="prefetch" href="/blog/assets/js/22.051b1897.js"><link rel="prefetch" href="/blog/assets/js/23.f0a176bb.js"><link rel="prefetch" href="/blog/assets/js/3.86e22dc1.js"><link rel="prefetch" href="/blog/assets/js/4.841cdf39.js"><link rel="prefetch" href="/blog/assets/js/5.8770cbf9.js"><link rel="prefetch" href="/blog/assets/js/6.331eafef.js"><link rel="prefetch" href="/blog/assets/js/7.e6f947b4.js"><link rel="prefetch" href="/blog/assets/js/8.e2ef4ac3.js"><link rel="prefetch" href="/blog/assets/js/9.8dc0a1f7.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.13ac442d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">MBIO blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/intro.html" class="nav-link">Intro</a></div><div class="nav-item"><a href="https://github.com/qnwlqnwlxm/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/intro.html" class="nav-link">Intro</a></div><div class="nav-item"><a href="https://github.com/qnwlqnwlxm/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/intro.html" class="sidebar-link">intro</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/ApacheNiFi/" class="sidebar-heading clickable router-link-active open"><span>Apaceh NiFi</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog/ApacheNiFi/Processor/" class="sidebar-heading clickable"><span>NiFi Custom Processor</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/blog/ApacheNiFi/ControllerService/" class="sidebar-heading clickable router-link-active open"><span>NiFi Custom ControllerService</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/ApacheNiFi/ControllerService/make-project-controller-service.html" class="sidebar-link">프로젝트 생성</a></li><li><a href="/blog/ApacheNiFi/ControllerService/HikariCPControllerService-1.html" class="sidebar-link">HikariCPControllerService-1</a></li><li><a href="/blog/ApacheNiFi/ControllerService/HikariCPControllerService-2.html" class="active sidebar-link">HikariCPControllerService-2</a></li><li><a href="/blog/ApacheNiFi/ControllerService/HikariCPControllerService-3.html" class="sidebar-link">HikariCPControllerService-3</a></li></ul></section></li></ul></section></li><li><a href="/blog/Spring/" class="sidebar-link">Spring</a></li><li><a href="/blog/Tech/" class="sidebar-link">Tech</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hikaricp-controller-service"><a href="#hikaricp-controller-service" aria-hidden="true" class="header-anchor">#</a> HikariCP Controller Service</h1> <h2 id="hikaricpcontrollerservice-2"><a href="#hikaricpcontrollerservice-2" aria-hidden="true" class="header-anchor">#</a> HikariCPControllerService - 2</h2> <h3 id="dependency-추가"><a href="#dependency-추가" aria-hidden="true" class="header-anchor">#</a> dependency 추가</h3> <p>Controller Service는 processor에 비해 로직이 없고, 기술적인 부분만 있기때문에 상대적으로 수정할 코드 양은 적습니다.</p> <p>HikariCP를 사용하기 위해 dependency를 추가해줍니다.</p> <p>그리고 postgreSQL을 위한 드라이버, 테스트를 위한 apache derby, meric데이터를 위한 dropwizard-metrics까지 추가합니다.</p> <p>아래 내용을 최상위 pom.xml에 추가해줍니다.</p> <details><summary>parent pom.xml</summary> <p></p><div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hikaricp.version</span><span class="token punctuation">&gt;</span></span>3.4.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hikaricp.version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dropwizard.version</span><span class="token punctuation">&gt;</span></span>1.3.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dropwizard.version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>postgresql.jdbc.version</span><span class="token punctuation">&gt;</span></span>42.2.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>postgresql.jdbc.version</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>derby.version</span><span class="token punctuation">&gt;</span></span>10.14.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>derby.version</span><span class="token punctuation">&gt;</span></span>
		
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.zaxxer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>HikariCP<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${hikaricp.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.postgresql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>postgresql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${postgresql.jdbc.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.dropwizard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dropwizard-metrics<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${dropwizard.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.derby<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>derbyclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${derby.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.derby<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>derbynet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${derby.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p></p></details> <p>최상위 pom.xml에 dependency를 추가했으면 service(nifi-hikaricp)의 pom.xml에도 dependency를 추가해줍니다.</p> <details><summary>nifi-hikaricp pom.xml</summary> <p></p><div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.zaxxer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>HikariCP<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.postgresql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>postgresql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.dropwizard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dropwizard-metrics<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.derby<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>derbyclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.derby<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>derbynet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p></p></details> <p>그리고 interface는 nifi에서 제공해주던 dbcp service의 인터페이스를 상속받아서 사용합니다. 그래야 기존 dbcp service를 사용하던 프로세서에서도 hikariCP를 사용할 수 이습니다.</p> <p>아래처럼 nifi-hikaricp-api의 pom.xml에 dependency를 추가합니다.</p> <details><summary>nifi-hikaricp-api pom.xml</summary> <p></p><div class="language-xml extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.nifi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>nifi-dbcp-service-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.nifi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>nifi-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p></p></details> <h3 id="interface-정의"><a href="#interface-정의" aria-hidden="true" class="header-anchor">#</a> Interface 정의</h3> <p>nifi dbcp의 인터페이스를 상속받았기 때문에 아래처럼 Tags 정보와 description정보정도만 추가하고, extends를 DBCPService로 변경합니다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Tags</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;DBCP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SQL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Database&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;HikariCP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NICE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@CapabilityDescription</span><span class="token punctuation">(</span><span class="token string">&quot;Database connection pooling using HikariCP API&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HikariCPService</span> <span class="token keyword">extends</span> <span class="token class-name">DBCPService</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="standardhikaricpservice-코드-수정"><a href="#standardhikaricpservice-코드-수정" aria-hidden="true" class="header-anchor">#</a> StandardHikariCPService 코드 수정</h3> <p>interface가 변경되었기 때문에 StandardHikariCPService class에서 unimplemented method를 작성하라고 에러를 표시할 것입니다.</p> <p>해당 메소드를 추가하고 기존에 있던 overrid 한 execute() 는 삭제합니다.</p> <p>그럼 코드가 아래와 같은 형태로 변경됩니다.</p> <details><summary>StandardHikariCPService.java</summary> <p></p><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StandardHikariCPService</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractControllerService</span> <span class="token keyword">implements</span> <span class="token class-name">HikariCPService</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PropertyDescriptor</span> MY_PROPERTY <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;MY_PROPERTY&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token string">&quot;My Property&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;Example Property&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addValidator</span><span class="token punctuation">(</span><span class="token class-name">StandardValidators</span><span class="token punctuation">.</span>NON_EMPTY_VALIDATOR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">&gt;</span></span> properties<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">&gt;</span></span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        props<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>MY_PROPERTY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSupportedPropertyDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> properties<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param context the configuration context
     * @throws InitializationException if unable to create a database connection
     */</span>
    <span class="token annotation punctuation">@OnEnabled</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onEnabled</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ConfigurationContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InitializationException</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@OnDisabled</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ProcessException</span> <span class="token punctuation">{</span>
        <span class="token comment">// TODO Auto-generated method stub</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><p></p></details> <h3 id="property-정의"><a href="#property-정의" aria-hidden="true" class="header-anchor">#</a> property 정의</h3> <p>이제 custom processor를 작성했을 때와 마찬가지로 property를 작성합니다.</p> <p>service의 경우 input, output이 있는 형태가 아니기 때문에 relation은 따로 없습니다.</p> <p>마찬가지로 StandardHikariCPService class와 동일한 위치에 ConfigUtil class를 작성합니다. 코드는 아래와 같습니다.</p> <details><summary>DataSourcePropertyValidator.java</summary> <p></p><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mbio<span class="token punctuation">.</span>custom<span class="token punctuation">.</span>hikaricp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>derby<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">.</span><span class="token class-name">ClientDataSource</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>components</span><span class="token punctuation">.</span><span class="token class-name">AllowableValue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>components</span><span class="token punctuation">.</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>processor<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">StandardValidators</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>postgresql<span class="token punctuation">.</span>ds</span><span class="token punctuation">.</span><span class="token class-name">PGSimpleDataSource</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ConfigUtil</span> <span class="token punctuation">{</span>

    INSTANCE<span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">&gt;</span></span> properties<span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">AllowableValue</span> DERBY_DS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AllowableValue</span><span class="token punctuation">(</span>
        <span class="token class-name">ClientDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Apache Derby&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Apache Derby Datasource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">AllowableValue</span> PGSQL_DS <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">AllowableValue</span><span class="token punctuation">(</span><span class="token class-name">PGSimpleDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;PostgreSQL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PostgreSQL Datasource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PropertyDescriptor</span> DATASOURCE_CLASSNAME <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;dataSourceClassName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token string">&quot;Datasource classname&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;Fully qualified classname of datasource&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowableValues</span><span class="token punctuation">(</span><span class="token function">getAllowableValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addValidator</span><span class="token punctuation">(</span><span class="token class-name">StandardValidators</span><span class="token punctuation">.</span>NON_EMPTY_VALIDATOR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PropertyDescriptor</span> USERNAME <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;userName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token string">&quot;User Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;Database account user name&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addValidator</span><span class="token punctuation">(</span><span class="token class-name">StandardValidators</span><span class="token punctuation">.</span>NON_EMPTY_VALIDATOR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PropertyDescriptor</span> PASSWORD <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token string">&quot;Password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;Database account password&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addValidator</span><span class="token punctuation">(</span><span class="token class-name">StandardValidators</span><span class="token punctuation">.</span>NON_EMPTY_VALIDATOR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sensitive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PropertyDescriptor</span> AUTO_COMMIT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;autoCommit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token string">&quot;Auto commit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;Database account user name&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowableValues</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addValidator</span><span class="token punctuation">(</span><span class="token class-name">StandardValidators</span><span class="token punctuation">.</span>BOOLEAN_VALIDATOR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PropertyDescriptor</span> METRICS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;metrics&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token string">&quot;Metrics&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;Whether or not to log metrics&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allowableValues</span><span class="token punctuation">(</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addValidator</span><span class="token punctuation">(</span><span class="token class-name">StandardValidators</span><span class="token punctuation">.</span>BOOLEAN_VALIDATOR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">&gt;</span></span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>DATASOURCE_CLASSNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>USERNAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>PASSWORD<span class="token punctuation">)</span><span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>AUTO_COMMIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>METRICS<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">&gt;</span></span> <span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> properties<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PropertyDescriptor</span> <span class="token function">getDynamicProperty</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyDescriptorName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PropertyDescriptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>propertyDescriptorName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">addValidator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DataSourcePropertyValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dynamic</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">AllowableValue</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getAllowableValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AllowableValue</span><span class="token punctuation">&gt;</span></span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AllowableValue</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      values<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>DERBY_DS<span class="token punctuation">)</span><span class="token punctuation">;</span>
      values<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>PGSQL_DS<span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AllowableValue</span><span class="token punctuation">[</span>values<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
  <span class="token punctuation">}</span>
  

</code></pre></div><p></p></details> <h3 id="dynamic-property-를-위한-validation-추가"><a href="#dynamic-property-를-위한-validation-추가" aria-hidden="true" class="header-anchor">#</a> Dynamic Property 를 위한 validation 추가</h3> <p>위의 소스를 이용하여 ConfigUtil을 만들면 에러가 발생할 것입니다.</p> <p>NiFi의 Dynamic Property를 지원하기 위해 Dynamic Validation을 추가했습니다.</p> <p>DBCP연결시에 jdbcurl의 경우 아래와 같이 ? 뒤에 설정을 추가할 수 있습니다.</p> <p>이와 같은 형태를 dynamic property로 지원하고, 잘못된 옵션을 추가했을때 service가 실행 되지 않고 에러를 뱉어내기 위해 validation을 추가했습니다.</p> <div class="language- extra-class"><pre class="language-text"><code>jdbc:mysql://localhost:3306/dbname?characterEncoding=utf8
</code></pre></div><p>ConfigUtil과 동일 한 위치에 DataSourcePropertyValidator class를 생성합니다.</p> <details><summary>ConfigUtil.java</summary> <p></p><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mbio<span class="token punctuation">.</span>custom<span class="token punctuation">.</span>hikaricp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>beans</span><span class="token punctuation">.</span><span class="token class-name">Introspector</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect</span><span class="token punctuation">.</span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>components</span><span class="token punctuation">.</span><span class="token class-name">ValidationContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>components</span><span class="token punctuation">.</span><span class="token class-name">ValidationResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>components</span><span class="token punctuation">.</span><span class="token class-name">Validator</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourcePropertyValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">ValidationResult</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">,</span> <span class="token class-name">String</span> <span class="token class-name">PropertyValue</span><span class="token punctuation">,</span>
      <span class="token class-name">ValidationContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> dsClassName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span>DATASOURCE_CLASSNAME<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ValidationResult</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token class-name">PropertyValue</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">valid</span><span class="token punctuation">(</span><span class="token function">isValidProperty</span><span class="token punctuation">(</span>dsClassName<span class="token punctuation">,</span> propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">explanation</span><span class="token punctuation">(</span>propertyName <span class="token operator">+</span> <span class="token string">&quot; is not a valid property&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isValidProperty</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> dsClassName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> propertyName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> dsClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>dsClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> dsClass<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> methods<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>methodName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;set&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">String</span> dsProperty <span class="token operator">=</span> <span class="token class-name">Introspector</span><span class="token punctuation">.</span><span class="token function">decapitalize</span><span class="token punctuation">(</span>methodName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>dsProperty<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p></p></details> <h3 id="standardhikaricpservice-작성"><a href="#standardhikaricpservice-작성" aria-hidden="true" class="header-anchor">#</a> StandardHikariCPService 작성</h3> <p>이제 property 설정까지 마쳤으니 HikariCP를 이용하여 DBCP를 생성하는 로직을 작성합니다.</p> <p>StandardHikariCPService class를 다음과 같이 변경합니다.</p> <details><summary>StandardHikariCPService.java</summary> <p></p><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mbio<span class="token punctuation">.</span>custom<span class="token punctuation">.</span>hikaricp</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql</span><span class="token punctuation">.</span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql</span><span class="token punctuation">.</span><span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic</span><span class="token punctuation">.</span><span class="token class-name">AtomicReference</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>codahale<span class="token punctuation">.</span>metrics</span><span class="token punctuation">.</span><span class="token class-name">MetricRegistry</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>zaxxer<span class="token punctuation">.</span>hikari</span><span class="token punctuation">.</span><span class="token class-name">HikariDataSource</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>behavior</span><span class="token punctuation">.</span><span class="token class-name">DynamicProperty</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>documentation</span><span class="token punctuation">.</span><span class="token class-name">CapabilityDescription</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>documentation</span><span class="token punctuation">.</span><span class="token class-name">Tags</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>lifecycle</span><span class="token punctuation">.</span><span class="token class-name">OnDisabled</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>lifecycle</span><span class="token punctuation">.</span><span class="token class-name">OnEnabled</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>components</span><span class="token punctuation">.</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>controller</span><span class="token punctuation">.</span><span class="token class-name">AbstractControllerService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>controller</span><span class="token punctuation">.</span><span class="token class-name">ConfigurationContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>processor<span class="token punctuation">.</span>exception</span><span class="token punctuation">.</span><span class="token class-name">ProcessException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>reporting</span><span class="token punctuation">.</span><span class="token class-name">InitializationException</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Tags</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;DBCP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SQL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Database&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;HikariCP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NICE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@CapabilityDescription</span><span class="token punctuation">(</span><span class="token string">&quot;Database connection pooling using HikariCP API&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DynamicProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;DataSource property&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;The value to set it to&quot;</span><span class="token punctuation">,</span>
    description <span class="token operator">=</span> <span class="token string">&quot;Property for the selected DataSource&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StandardHikariCPService</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractControllerService</span> <span class="token keyword">implements</span> <span class="token class-name">HikariCPService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HikariDataSource</span><span class="token punctuation">&gt;</span></span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PropertyDescriptor</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSupportedPropertyDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">PropertyDescriptor</span> <span class="token function">getSupportedDynamicPropertyDescriptor</span><span class="token punctuation">(</span>
        <span class="token class-name">String</span> propertyDescriptorName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
      <span class="token keyword">return</span> <span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span><span class="token function">getDynamicProperty</span><span class="token punctuation">(</span>propertyDescriptorName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token comment">/**
     * @param context the configuration context
     * @throws InitializationException if unable to create a database connection
     */</span>
    <span class="token annotation punctuation">@OnEnabled</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onEnabled</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ConfigurationContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InitializationException</span> <span class="token punctuation">{</span>
  
      <span class="token class-name">HikariDataSource</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
      <span class="token keyword">final</span> <span class="token class-name">String</span> dsClassName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span>DATASOURCE_CLASSNAME<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> <span class="token class-name">String</span> userName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span>USERNAME<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> <span class="token class-name">String</span> password <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span>PASSWORD<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> <span class="token keyword">boolean</span> autoCommit <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span>AUTO_COMMIT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> <span class="token keyword">boolean</span> metrics <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token class-name">ConfigUtil</span><span class="token punctuation">.</span>METRICS<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
      ds<span class="token punctuation">.</span><span class="token function">setDataSourceClassName</span><span class="token punctuation">(</span>dsClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ds<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
      ds<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span>autoCommit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
      <span class="token keyword">if</span> <span class="token punctuation">(</span>metrics<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ds<span class="token punctuation">.</span><span class="token function">setMetricRegistry</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MetricRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  
      context<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            ds<span class="token punctuation">.</span><span class="token function">addDataSourceProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
      <span class="token keyword">this</span><span class="token punctuation">.</span>ds<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token annotation punctuation">@OnDisabled</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ProcessException</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Could not get connecdtion from datasources&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><p></p></details> <p>여기까지 진행했으면 전체 소스는 다 완성한 것입니다.</p> <p>이제 다음시간에는 정상적으로 HikariCP를 이용한 커넥션풀이 생성되는지 확인하기 위한 테스트 코드를 작성하겠습니다.</p> <hr> <p>변경사항은 아래에서 확인할 수 있습니다.</p> <p><a href="https://github.com/qnwlqnwlxm/HikariCPService/compare/HikariCPControllerSerivce-1...HikariCPControllerSerivce-2" target="_blank" rel="noopener noreferrer">https://github.com/qnwlqnwlxm/HikariCPService/compare/HikariCPControllerSerivce-1...HikariCPControllerSerivce-2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>전체소스는 아래 에서 다운로드 가능합니다.
<a href="https://github.com/qnwlqnwlxm/HikariCPService/tree/HikariCPControllerSerivce-2" target="_blank" rel="noopener noreferrer">https://github.com/qnwlqnwlxm/HikariCPService/tree/HikariCPControllerSerivce-2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/ApacheNiFi/ControllerService/HikariCPControllerService-1.html" class="prev">HikariCP Controller Service</a></span> <span class="next"><a href="/blog/ApacheNiFi/ControllerService/HikariCPControllerService-3.html">HikariCP Controller Service</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.789fa554.js" defer></script><script src="/blog/assets/js/13.7f9cd5cc.js" defer></script><script src="/blog/assets/js/2.52a581a5.js" defer></script><script src="/blog/assets/js/16.62b0f00f.js" defer></script>
  </body>
</html>
